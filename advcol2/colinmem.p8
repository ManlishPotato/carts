pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
p1={}
p1.x=0
p1.y=0
p1.lastx=0
p1.lasty=0

p1.spr=2
p1.r=0
p1.sel=2

tet_i={56,56, -8,0,4} --1
tet_t={56,56, -8,0,3, 0,8,1} --2

function _init()
	table=tet_t --Set start tetramino
	p1.x,p1.y=table[1],table[2] --Set start pos
end

function _update()
	cls()
	map(0,0,0,0,16,16)

	move()
	collision()
	drawspr()

	--pset(p1.x,p1.y,0)

	print(p1.x,10,10,12)
	print(p1.y,20,10,12)

	print(p1.r,nil,nil,8)
end

function move()
	p1.lastx=p1.x
	p1.lasty=p1.y
	if(btnp(0)) then p1.x-=8 end
	if(btnp(1)) then p1.x+=8 end
	if(btnp(2)) then p1.y-=8 end
	if(btnp(3)) then p1.y+=8 end

	--rotation buttonmap
	if(btnp(4)) then p1.r+=90 end
	if(p1.r>270) then p1.r=0 end

	--selection buttonmap
	if(btnp(5)) then p1.sel+=1 end
	if(p1.sel>2) then p1.sel=1 end

	--mapping tetraminoes to p1 selection
	if(p1.sel==1) then table=tet_i end
	if(p1.sel==2) then table=tet_t end
end

function collision()
	local pos_x=0
	local pos_y=0
	local rot_x=0
 local rot_y=0

 for i=1,table[5],1 do

 	rot_x,rot_y=rot(table[3]+pos_x,table[4]+pos_y)
 	
 	for k=0,7,7 do
 		for l=0,7,7 do
 			pset(p1.x+rot_x+l,p1.y+rot_y+k,7)
 			
 			flag=fget(mget((p1.x+rot_x+l)/8,(p1.y+rot_y+k)/8),0)
 			
 			if(flag) then 
 				print("flag!!!") 
 				p1.x=p1.lastx
 				p1.y=p1.lasty
 			end
 		end
 	end
 	
 	pos_x+=8
 end

 if(table[6]!=nil) then
 	pos_x=0
 	pos_y=0

		for n=1,table[8],1 do
			rot_x,rot_y=rot(table[6]+pos_x,table[7]+pos_y)

		for v=0,7,7 do
 		for b=0,7,7 do
 			pset(p1.x+rot_x+b,p1.y+rot_y+v,7)
 			
 			flag=fget(mget((p1.x+rot_x+b)/8,(p1.y+rot_y+v)/8),0)
 			
 			if(flag) then 
 				print("flag!!!") 
 				p1.x=p1.lastx
 				p1.y=p1.lasty
 			end
 		end
 	end
			
			pos_x+=8
		end
 end	
end

function drawspr()
	local pos_x=0
	local pos_y=0
	local rot_x=0
 local rot_y=0

	--first row
 for i=1,table[5],1 do

 	rot_x,rot_y=rot(table[3]+pos_x,table[4]+pos_y)

 	spr(p1.spr,p1.x+rot_x,p1.y+rot_y)
 	pos_x+=8
 end

 --check for another row
 if(table[6]!=nil) then
 	pos_x=0
 	pos_y=0

 	--second row
		for n=1,table[8],1 do
			rot_x,rot_y=rot(table[6]+pos_x,table[7]+pos_y)

			spr(p1.spr,p1.x+rot_x,p1.y+rot_y)
			pos_x+=8
		end
 end
end

function rot(val_x,val_y)
 if(p1.r==0) then
 	return val_x,val_y
	end

	if(p1.r==90) then
	 return (val_y)*-1,val_x
	end

	if(p1.r==180) then
		return (val_x)*-1,(val_y)*-1
	end

	if(p1.r==270) then
	 return val_y,(val_x)*-1
	end
end
__gfx__
000000007777777788888888cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007777777780000008c000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007777777780000008c0cccc0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770007777777780000008c0c00c0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770007777777780000008c0c00c0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007777777780000008c0cccc0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007777777780000008c000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007777777788888888cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010100000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000003030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000003030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000003030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000003030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000003030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000003030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100010001030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100010001030303030303000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100010001000000010100000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100010101000000010000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
