pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
ma = {} --marker

ma.x = 40 --player1 pos x
ma.y = 40 --player1 pos y
ma.dx = 0 --x velocity
ma.dy = 0 --y velocity
ma.s = 49 --selection
ma.pre = false --preview

h=128 --size of room
w=128
end

function _update()
cls() --clear screen
map(0,0,0,0,128,128) --draw map
spr(1,ma.x,ma.y) --draw character sprite
--print (p1.x) 
--print (p1.y)

if(ma.pre==true) then
spr(ma.s,0,0)
end

adder()
mainmovement() --move the character and detect collision
machinecontroller()
end

function adder()
if(btnp(5)) then 
ma.s += 1
ma.pre=true
end
if(ma.s > 52) then
ma.s=49
end

if(btn(4)) then 
mset(ma.x1,ma.y1,ma.s)
end
end

function mainmovement()
local lx = ma.x --last x
local ly = ma.y --last y

ma.dx = 0 --x reset the vel
ma.dy = 0 --y reset the vel

if(btnp(0)) ma.dx -= 8 --detect button and apply to vel
if(btnp(1)) ma.dx += 8
if(btnp(2)) ma.dy -= 8
if(btnp(3)) ma.dy += 8

ma.x += ma.dx --apply vel to pos
ma.y += ma.dy

ma.x1 = ma.x / 8 --divide pos to get cel pos
ma.y1 = ma.y / 8

ma.x2 = (ma.x+7) / 8 --same as above on a diff point
ma.y2 = (ma.y+7) / 8

local asn=fget(mget(ma.x1,ma.y1),0) --test for flag on 4 diff points
local bsn=fget(mget(ma.x1,ma.y2),0)
local csn=fget(mget(ma.x2,ma.y2),0)
local dsn=fget(mget(ma.x2,ma.y1),0)

if(asn or bsn or csn or dsn==true)
then ma.x = lx ma.y = ly --reset pos to last
end
end

function machinecontroller()
	local a = 1
	local b = 1
	local sel = 0
	
 while a <= 14 do
 	if(mget(a,b) >= 49 and mget(a,b) <= 51) then
 		sel=mget(a,b)
 		mset(a,b,sel+1)
 	elseif(mget(a,b)==52) then mset(a,b,49) end
 	a+=1
 	if(a==14) then
 		a=1
 		b+=1
 	elseif(b==14) then
 		a=15
 		print("end of line")
 	end
	end
end
__gfx__
00000000bbb00bbb0000000011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b330033b0000000017777771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b300003b0000000017777771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000880000000000017777771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000880000000000017777771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b300003b0000000017777771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b330033b0000000017777771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb00bbb0000000011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777737777777733333333377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777737777777777777777377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777737777777777777777377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777737777777777777777377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777737777777777777777377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777737777777777777777377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777737777777777777777377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777733333333377777777377777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000444444444444444444444444444444444558855422222222aaaaaaaa444aa44400000000000000000000000000000000000000000000000000000000
0000000088558855588558855588558885588558458888542aa44442aaaaaaaa000aa00000000000000000000000000000000000000000000000000000000000
0000000058855885558855888558855888558855488558842aa44842aaaaaaaa444aa44400000000000000000000000000000000000000000000000000000000
0000000055885588855885588855885558855885485555842aa44442aaaaaaaa4ffffff400000000000000000000000000000000000000000000000000000000
0000000055885588855885588855885558855885455885542a444aa2aaaaaaaa4ffffff400000000000000000000000000000000000000000000000000000000
0000000058855885558855888558855888558855458888542488aaa2aaaaaaaa4ffffff400000000000000000000000000000000000000000000000000000000
0000000088558855588558855588558885588558488558842444aaa2aaaaaaaa4ffffff400000000000000000000000000000000000000000000000000000000
00000000444444444444444444444444444444444855558422222222aaaaaaaa4444444400000000000000000000000000000000000000000000000000000000
00000000dd6ddd6dddd6ddd66ddd6dddd6ddd6dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000117111711117111771117111171117110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000117111711117111771117111171117110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111711177111711117111711117111710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111711177111711117111711117111710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000117111711117111771117111171117110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000117111711117111771117111171117110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dd6ddd6dddd6ddd66ddd6dddd6ddd6dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1112121212121212121212121212121400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1108030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1103030303030303030303030303031400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1113131313131313131313131313131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
